# Funcionalidad de Imagen de Perfil

## Descripci√≥n
Esta funcionalidad permite a los usuarios subir y actualizar su foto de perfil en la aplicaci√≥n. La imagen se almacena en Supabase Storage y la URL se guarda en la columna `profile_image` de la tabla `person`.

## Caracter√≠sticas

### ‚úÖ Funcionalidades Implementadas
- **Subida de imagen**: Los usuarios pueden seleccionar y subir una imagen desde su dispositivo
- **Validaci√≥n de archivo**: Solo se permiten archivos de imagen (JPG, PNG, GIF)
- **L√≠mite de tama√±o**: M√°ximo 5MB por imagen
- **Almacenamiento en Supabase**: Las im√°genes se guardan en el bucket `store-assets` en la carpeta `stores/user_image_profiles`
- **Actualizaci√≥n autom√°tica**: La URL de la imagen se actualiza autom√°ticamente en la base de datos
- **Interfaz de usuario**: Bot√≥n intuitivo para cambiar la foto con indicador de carga
- **Mensajes de estado**: Feedback visual para el usuario sobre el √©xito o error de la operaci√≥n

### üîß Componentes Utilizados
- **ProfilePage**: Componente principal que maneja la interfaz de usuario
- **usePerson**: Hook personalizado que maneja la l√≥gica de negocio
- **Supabase Storage**: Para el almacenamiento de archivos
- **UI Components**: Botones, inputs y cards de la librer√≠a de componentes

## Estructura de Archivos

### Supabase Storage
```
store-assets/
‚îî‚îÄ‚îÄ stores/
    ‚îî‚îÄ‚îÄ user_image_profiles/
        ‚îú‚îÄ‚îÄ {user_id}_{timestamp}.jpg
        ‚îú‚îÄ‚îÄ {user_id}_{timestamp}.png
        ‚îî‚îÄ‚îÄ {user_id}_{timestamp}.gif
```

### Base de Datos
```sql
-- Tabla person
CREATE TABLE public.person (
  id bigint GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  profile_image text NULL, -- URL de la imagen de perfil
  -- ... otros campos
);
```

## Flujo de Funcionamiento

1. **Selecci√≥n de archivo**: El usuario hace clic en "Cambiar Foto"
2. **Validaci√≥n**: Se verifica el tipo y tama√±o del archivo
3. **Subida**: La imagen se sube a Supabase Storage con un nombre √∫nico
4. **Generaci√≥n de URL**: Se obtiene la URL p√∫blica de la imagen
5. **Actualizaci√≥n de BD**: Se actualiza la columna `profile_image` en la tabla `person`
6. **Actualizaci√≥n de UI**: La interfaz se actualiza para mostrar la nueva imagen

## Configuraci√≥n Requerida

### Supabase Storage
- Bucket: `store-assets`
- Carpeta: `stores/user_image_profiles`
- Pol√≠ticas de acceso configuradas para permitir subidas autenticadas

### Variables de Entorno
```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

## Uso del Hook

```typescript
const { person, uploadingImage, uploadProfileImage } = usePerson();

// Subir una nueva imagen
const handleImageUpload = async (file: File) => {
  const result = await uploadProfileImage(file);
  if (result?.success) {
    console.log('Imagen subida exitosamente');
  }
};
```

## Estados de la Aplicaci√≥n

- **loading**: Cargando datos del perfil
- **updating**: Actualizando informaci√≥n del perfil
- **uploadingImage**: Subiendo imagen de perfil
- **error**: Error en alguna operaci√≥n
- **successMessage**: Mensaje de √©xito
- **imageMessage**: Mensaje relacionado con la imagen

## Validaciones

### Tipo de Archivo
- Solo se permiten archivos de imagen (`image/*`)
- Formatos soportados: JPG, PNG, GIF

### Tama√±o de Archivo
- M√°ximo: 5MB
- Se muestra mensaje de error si excede el l√≠mite

### Usuario Autenticado
- Solo usuarios autenticados pueden subir im√°genes
- Se verifica que exista un usuario y una persona asociada

## Manejo de Errores

- **Error de subida**: Se muestra mensaje espec√≠fico del error
- **Error de validaci√≥n**: Se muestra mensaje explicativo
- **Error de red**: Se muestra mensaje gen√©rico de error
- **Timeout autom√°tico**: Los mensajes desaparecen despu√©s de 3 segundos

## Consideraciones de Rendimiento

- **Lazy loading**: Las im√°genes se cargan solo cuando son necesarias
- **Optimizaci√≥n**: Se recomienda usar `<Image />` de Next.js para mejor rendimiento
- **Cache**: Las im√°genes se almacenan con cache control de 1 hora

## Futuras Mejoras

- [ ] Compresi√≥n autom√°tica de im√°genes
- [ ] Recorte y redimensionamiento de im√°genes
- [ ] Soporte para m√∫ltiples formatos de imagen
- [ ] Historial de im√°genes de perfil
- [ ] Backup autom√°tico de im√°genes
- [ ] Integraci√≥n con CDN para mejor rendimiento
